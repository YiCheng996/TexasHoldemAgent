2025-02-25 11:46:36,103 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\game.yml
2025-02-25 11:46:36,107 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\llm.yml
2025-02-25 11:46:43,113 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\game.yml
2025-02-25 11:46:43,116 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\llm.yml
2025-02-25 11:46:46,724 - server - INFO - 返回主页: C:\Users\YiCheng\TexasHoldemAgent\src\web\index.html
2025-02-25 11:46:46,986 - server - INFO - 正在创建游戏: c47ed088-5731-4b8b-8ddd-0bbae37c6fdc, 玩家数量: 3
2025-02-25 11:46:46,987 - src.engine.dealer - INFO - Deck has been reset and shuffled
2025-02-25 11:46:46,987 - src.engine.state - INFO - 游戏状态已初始化
2025-02-25 11:46:46,987 - src.engine.game - INFO - 游戏 c47ed088-5731-4b8b-8ddd-0bbae37c6fdc 已初始化，玩家数量: 0，初始筹码: 1000，小盲注: 10
2025-02-25 11:46:46,988 - src.engine.state - INFO - Added player player_0 with 1000 chips at position 0
2025-02-25 11:46:46,988 - server - INFO - 添加人类玩家: player_0, 初始筹码: 1000
2025-02-25 11:46:46,989 - Agent_ai_1 - INFO - Agent ai_1 initialized with config: {'ai_players': {'ai_1': {'model': 'openai/gpt-4o', 'api_key': 'your api key', 'base_url': 'your base url', 'temperature': 0.8, 'max_tokens': 10000, 'timeout': 15, 'description': ''}, 'ai_2': {'model': 'openai/glm-4-plus', 'api_key': 'your api key', 'base_url': 'your base url', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 15, 'description': ''}, 'ai_3': {'model': 'openai/gpt-4o', 'api_key': 'your api key', 'base_url': 'your base url', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5}, 'ai_4': {'model': 'openai/qwen-max', 'api_key': 'your api key', 'base_url': 'your base url', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5}}, 'prompts': {'decision_making': '你是一个德州扑克AI玩家。{historical_context}。请根据当前游戏状态和历史信息，按照你的性格特征做出决策。\n\n游戏规则说明:\n1. 可用动作类型:\n   - FOLD (弃牌): 放弃当前手牌，退出本轮游戏\n   - CHECK (过牌): 不加注，保持当前下注额（仅当无人加注时可用）\n   - CALL (跟注): 跟随当前最大注额\n   - RAISE (加注): 将注额提高到指定数量，如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码。\n   - ALL_IN (全下): 押上所有剩余筹码，当筹码不足以加注时，可以选择全下来进行加注。\n\n2. 加注规则:\n   - 加注金额必须大于当前最大注额\n   - 加注金额必须至少是最小加注额\n   - 加注金额不能超过玩家剩余筹码\n   - 如果筹码不足以满足最小加注要求，只能选择 FOLD 或 ALL_IN\n\n3. 行动限制:\n   - 每个玩家每轮只能行动一次\n   - 必须按照顺时针顺序行动\n   - 如果前面有人加注，不能选择过牌\n   - 跟注或加注的金额必须精确匹配要求\n\n当前状态:\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 当前阶段: {phase}\n- 位置: {position}\n- 底池: {pot_size}\n- 当前最大注: {current_bet}\n- 最小加注额: {min_raise} (这是你必须加注到的最小金额)\n- 我的筹码: {chips}\n\n对手信息:\n{opponents}\n\n本轮动作历史:\n{round_actions}\n\n请记住你的性格特征，在做出决策时要体现出相应的风格。\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "action": {{\n    "type": "动作类型(FOLD/CHECK/CALL/RAISE/ALL_IN)",\n    "amount": "加注金额(如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码，如果筹码不足以满足最小加注要求，只能选择弃牌或全下)",\n    "confidence": "决策置信度(0-1)"\n  }},\n  "reasoning": {{\n    "hand_strength": "手牌强度分析",\n    "position_analysis": "位置分析",\n    "pot_odds": "底池赔率分析",\n    "opponent_reads": ["对手行为分析"]\n  }},\n  "table_talk": {{\n    "message": "发言内容",\n    "tone": "发言语气"\n  }}\n}}\n', 'round_summary': '请总结本轮游戏的关键信息:\n\n牌局信息:\n- 阶段: {phase}\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 最终底池: {pot_size}\n- 获得筹码: {chips_won}\n\n玩家动作:\n{player_actions}\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "analysis": {{\n    "strategy_patterns": ["策略模式分析"],\n    "key_decisions": ["关键决策分析"],\n    "improvements": ["改进建议"]\n  }},\n  "metadata": {{\n    "importance": "重要性评分(1-5)",\n    "tags": ["相关标签"]\n  }}\n}} \n'}, 'memory': {'short_term': {'max_rounds': 10}, 'long_term': {'collection': 'poker_memories', 'max_results': 5, 'similarity_threshold': 0.8, 'pruning_days': 30}}}
2025-02-25 11:46:46,990 - src.agents.llm - INFO - LLM Agent ai_1 初始化完成，使用模型 openai/gpt-4o，性格: 
2025-02-25 11:46:46,990 - src.engine.state - INFO - Added player ai_1 with 1000 chips at position 1
2025-02-25 11:46:46,990 - src.engine.game - INFO - Added player ai_1 to game c47ed088-5731-4b8b-8ddd-0bbae37c6fdc
2025-02-25 11:46:46,991 - server - INFO - 成功创建AI玩家: ai_1, 模型: openai/gpt-4o
2025-02-25 11:46:46,991 - Agent_ai_2 - INFO - Agent ai_2 initialized with config: {'ai_players': {'ai_1': {'model': 'openai/gpt-4o', 'api_key': 'your api key', 'base_url': 'your base url', 'temperature': 0.8, 'max_tokens': 10000, 'timeout': 15, 'description': ''}, 'ai_2': {'model': 'openai/glm-4-plus', 'api_key': 'your api key', 'base_url': 'your base url', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 15, 'description': ''}, 'ai_3': {'model': 'openai/gpt-4o', 'api_key': 'your api key', 'base_url': 'your base url', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5}, 'ai_4': {'model': 'openai/qwen-max', 'api_key': 'your api key', 'base_url': 'your base url', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5}}, 'prompts': {'decision_making': '你是一个德州扑克AI玩家。{historical_context}。请根据当前游戏状态和历史信息，按照你的性格特征做出决策。\n\n游戏规则说明:\n1. 可用动作类型:\n   - FOLD (弃牌): 放弃当前手牌，退出本轮游戏\n   - CHECK (过牌): 不加注，保持当前下注额（仅当无人加注时可用）\n   - CALL (跟注): 跟随当前最大注额\n   - RAISE (加注): 将注额提高到指定数量，如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码。\n   - ALL_IN (全下): 押上所有剩余筹码，当筹码不足以加注时，可以选择全下来进行加注。\n\n2. 加注规则:\n   - 加注金额必须大于当前最大注额\n   - 加注金额必须至少是最小加注额\n   - 加注金额不能超过玩家剩余筹码\n   - 如果筹码不足以满足最小加注要求，只能选择 FOLD 或 ALL_IN\n\n3. 行动限制:\n   - 每个玩家每轮只能行动一次\n   - 必须按照顺时针顺序行动\n   - 如果前面有人加注，不能选择过牌\n   - 跟注或加注的金额必须精确匹配要求\n\n当前状态:\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 当前阶段: {phase}\n- 位置: {position}\n- 底池: {pot_size}\n- 当前最大注: {current_bet}\n- 最小加注额: {min_raise} (这是你必须加注到的最小金额)\n- 我的筹码: {chips}\n\n对手信息:\n{opponents}\n\n本轮动作历史:\n{round_actions}\n\n请记住你的性格特征，在做出决策时要体现出相应的风格。\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "action": {{\n    "type": "动作类型(FOLD/CHECK/CALL/RAISE/ALL_IN)",\n    "amount": "加注金额(如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码，如果筹码不足以满足最小加注要求，只能选择弃牌或全下)",\n    "confidence": "决策置信度(0-1)"\n  }},\n  "reasoning": {{\n    "hand_strength": "手牌强度分析",\n    "position_analysis": "位置分析",\n    "pot_odds": "底池赔率分析",\n    "opponent_reads": ["对手行为分析"]\n  }},\n  "table_talk": {{\n    "message": "发言内容",\n    "tone": "发言语气"\n  }}\n}}\n', 'round_summary': '请总结本轮游戏的关键信息:\n\n牌局信息:\n- 阶段: {phase}\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 最终底池: {pot_size}\n- 获得筹码: {chips_won}\n\n玩家动作:\n{player_actions}\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "analysis": {{\n    "strategy_patterns": ["策略模式分析"],\n    "key_decisions": ["关键决策分析"],\n    "improvements": ["改进建议"]\n  }},\n  "metadata": {{\n    "importance": "重要性评分(1-5)",\n    "tags": ["相关标签"]\n  }}\n}} \n'}, 'memory': {'short_term': {'max_rounds': 10}, 'long_term': {'collection': 'poker_memories', 'max_results': 5, 'similarity_threshold': 0.8, 'pruning_days': 30}}}
2025-02-25 11:46:46,992 - src.agents.llm - INFO - LLM Agent ai_2 初始化完成，使用模型 openai/glm-4-plus，性格: 
2025-02-25 11:46:46,993 - src.engine.state - INFO - Added player ai_2 with 1000 chips at position 2
2025-02-25 11:46:46,993 - src.engine.game - INFO - Added player ai_2 to game c47ed088-5731-4b8b-8ddd-0bbae37c6fdc
2025-02-25 11:46:46,993 - server - INFO - 成功创建AI玩家: ai_2, 模型: openai/glm-4-plus
2025-02-25 11:46:46,993 - src.engine.game - INFO - 庄家位置移动到: 1
2025-02-25 11:46:46,994 - src.engine.state - INFO - 回合状态已重置
2025-02-25 11:46:46,994 - src.engine.dealer - INFO - Dealt hole cards to 3 players
2025-02-25 11:46:46,994 - src.engine.state - INFO - 玩家 ai_2 下注 10 筹码
2025-02-25 11:46:46,995 - src.engine.game - INFO - 玩家 ai_2 下注小盲注 10
2025-02-25 11:46:46,995 - src.engine.state - INFO - 玩家 player_0 下注 20 筹码
2025-02-25 11:46:46,995 - src.engine.game - INFO - 玩家 player_0 下注大盲注 20
2025-02-25 11:46:46,995 - src.engine.game - INFO - 已收取盲注: 小盲注=ai_2(10)，大盲注=player_0(20)
2025-02-25 11:46:46,996 - src.engine.game - INFO - 当前玩家: ai_1
2025-02-25 11:46:46,996 - src.engine.game - INFO - Game c47ed088-5731-4b8b-8ddd-0bbae37c6fdc started
2025-02-25 11:46:46,996 - server - INFO - 游戏 c47ed088-5731-4b8b-8ddd-0bbae37c6fdc 已开始
2025-02-25 11:46:46,996 - server - INFO - 游戏初始状态: {'phase': 'PRE_FLOP', 'pot_size': 30, 'community_cards': [], 'current_player': 'ai_1', 'min_raise': 40, 'max_raise': 980, 'game_result': None, 'players': []}
2025-02-25 11:46:47,544 - server - INFO - WebSocket连接已建立: c47ed088-5731-4b8b-8ddd-0bbae37c6fdc
2025-02-25 11:46:47,545 - server - INFO - 发送初始游戏状态: {'phase': 'PRE_FLOP', 'pot_size': 30, 'community_cards': [], 'current_player': 'ai_1', 'min_raise': 40, 'max_raise': 980, 'game_result': None, 'players': [{'id': 'player_0', 'chips': 980, 'current_bet': 20, 'is_active': True, 'cards': ('3♥', 'Q♣'), 'is_all_in': False, 'position': 0, 'model_name': None, 'last_action': None, 'last_amount': None}, {'id': 'ai_1', 'chips': 1000, 'current_bet': 0, 'is_active': True, 'cards': ('6♥', '8♦'), 'is_all_in': False, 'position': 1, 'model_name': 'openai/gpt-4o', 'last_action': None, 'last_amount': None}, {'id': 'ai_2', 'chips': 990, 'current_bet': 10, 'is_active': True, 'cards': ('A♣', 'A♦'), 'is_all_in': False, 'position': 2, 'model_name': 'openai/glm-4-plus', 'last_action': None, 'last_amount': None}]}
2025-02-25 11:46:47,546 - server - INFO - 当前AI玩家: ai_1
2025-02-25 11:46:47,547 - server - INFO - AI玩家 ai_1 开始观察游戏状态
2025-02-25 11:46:47,547 - src.agents.llm - INFO - AI玩家 ai_1 观察到新的游戏状态
2025-02-25 11:46:47,547 - src.agents.llm - INFO - 
==================================================
2025-02-25 11:46:47,547 - src.agents.llm - INFO - 🤖 AI玩家 {self.agent_id} 思考中...
2025-02-25 11:46:47,548 - src.agents.llm - INFO - 使用模型: openai/gpt-4o
2025-02-25 11:46:49,433 - src.agents.llm - ERROR - ❌ LLM调用失败: litellm.APIError: APIError: OpenAIException - Connection error.
2025-02-25 11:46:49,433 - src.agents.llm - WARNING - 决策生成失败 (尝试 1/3): litellm.APIError: APIError: OpenAIException - Connection error.
2025-02-25 11:46:50,435 - src.agents.llm - INFO - 
==================================================
2025-02-25 11:46:50,435 - src.agents.llm - INFO - 🤖 AI玩家 {self.agent_id} 思考中...
2025-02-25 11:46:50,435 - src.agents.llm - INFO - 使用模型: openai/gpt-4o
2025-02-25 11:46:51,885 - src.agents.llm - ERROR - ❌ LLM调用失败: litellm.APIError: APIError: OpenAIException - Connection error.
2025-02-25 11:46:51,885 - src.agents.llm - WARNING - 决策生成失败 (尝试 2/3): litellm.APIError: APIError: OpenAIException - Connection error.
2025-02-25 11:46:52,899 - src.agents.llm - INFO - 
==================================================
2025-02-25 11:46:52,900 - src.agents.llm - INFO - 🤖 AI玩家 {self.agent_id} 思考中...
2025-02-25 11:46:52,900 - src.agents.llm - INFO - 使用模型: openai/gpt-4o
2025-02-25 11:46:54,260 - src.agents.llm - ERROR - ❌ LLM调用失败: litellm.APIError: APIError: OpenAIException - Connection error.
2025-02-25 11:46:54,261 - src.agents.llm - WARNING - 决策生成失败 (尝试 3/3): litellm.APIError: APIError: OpenAIException - Connection error.
2025-02-25 11:46:55,272 - src.agents.llm - ERROR - 达到最大重试次数，选择弃牌。最后一次错误: litellm.APIError: APIError: OpenAIException - Connection error.
2025-02-25 11:46:55,272 - server - INFO - AI玩家 ai_1 决定执行动作: FOLD, 金额: 0
2025-02-25 11:46:55,273 - src.engine.state - INFO - 玩家 ai_1 弃牌
2025-02-25 11:46:55,273 - src.engine.game - INFO - 玩家 ai_1 弃牌
2025-02-25 11:46:55,273 - src.engine.game - INFO - 当前最大下注额: 20
2025-02-25 11:46:55,273 - src.engine.game - INFO - 当前玩家更新为: player_0
2025-02-25 11:46:55,274 - src.engine.game - INFO - 当前最大下注额: 20
2025-02-25 11:46:55,274 - src.engine.game - INFO - 检查玩家 player_0: has_acted=False, current_bet=20, is_all_in=False
2025-02-25 11:46:55,274 - src.engine.game - INFO - 玩家 player_0 未行动且未全下，回合继续
2025-02-25 11:46:55,274 - server - INFO - 发送AI行动后的游戏状态: {'phase': 'PRE_FLOP', 'pot_size': 30, 'community_cards': [], 'current_player': 'player_0', 'min_raise': 0, 'max_raise': 0, 'game_result': None, 'players': [{'id': 'player_0', 'chips': 980, 'current_bet': 20, 'is_active': True, 'cards': ('3♥', 'Q♣'), 'is_all_in': False, 'position': 0, 'model_name': None, 'last_action': None, 'last_amount': None}, {'id': 'ai_1', 'chips': 1000, 'current_bet': 0, 'is_active': False, 'cards': [], 'is_all_in': False, 'position': 1, 'model_name': 'openai/gpt-4o', 'last_action': 'FOLD', 'last_amount': 0}, {'id': 'ai_2', 'chips': 990, 'current_bet': 10, 'is_active': True, 'cards': ('A♣', 'A♦'), 'is_all_in': False, 'position': 2, 'model_name': 'openai/glm-4-plus', 'last_action': None, 'last_amount': None}]}
2025-02-25 11:46:55,275 - src.engine.game - INFO - 当前最大下注额: 20
2025-02-25 11:46:55,276 - src.engine.game - INFO - 检查玩家 player_0: has_acted=False, current_bet=20, is_all_in=False
2025-02-25 11:46:55,276 - src.engine.game - INFO - 玩家 player_0 未行动且未全下，回合继续
2025-02-25 12:26:21,722 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\game.yml
2025-02-25 12:26:21,726 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\llm.yml
2025-02-25 12:26:28,805 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\game.yml
2025-02-25 12:26:28,809 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\llm.yml
2025-02-25 12:26:28,908 - server - INFO - 返回主页: C:\Users\YiCheng\TexasHoldemAgent\src\web\index.html
2025-02-25 12:26:29,156 - server - INFO - 正在创建游戏: b052bf8d-4edf-45f2-8952-228cd1a82ee5, 玩家数量: 5
2025-02-25 12:26:29,157 - src.engine.dealer - INFO - Deck has been reset and shuffled
2025-02-25 12:26:29,157 - src.engine.state - INFO - 游戏状态已初始化
2025-02-25 12:26:29,158 - src.engine.game - INFO - 游戏 b052bf8d-4edf-45f2-8952-228cd1a82ee5 已初始化，玩家数量: 0，初始筹码: 1000，小盲注: 10
2025-02-25 12:26:29,158 - src.engine.state - INFO - Added player player_0 with 1000 chips at position 0
2025-02-25 12:26:29,159 - server - INFO - 添加人类玩家: player_0, 初始筹码: 1000
2025-02-25 12:26:29,159 - Agent_ai_1 - INFO - Agent ai_1 initialized with config: {'ai_players': {'ai_1': {'model': 'openai/gpt-4o', 'api_key': 'fk230129-9OLw5WmxAHl1cRdmzXuzKIe3HYzEWjz3', 'base_url': 'https://oa.api2d.net/v1', 'temperature': 0.5, 'max_tokens': 10000, 'timeout': 15, 'description': '擅长使用策略和心理战术'}, 'ai_2': {'model': 'openai/deepseek-v3', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 15, 'description': '擅长使用策略和心理战术'}, 'ai_3': {'model': 'openai/claude-3-5-sonnet', 'api_key': 'fk230129-9OLw5WmxAHl1cRdmzXuzKIe3HYzEWjz3', 'base_url': 'https://oa.api2d.net/claude/v1/', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5, 'description': '擅长使用策略和心理战术'}, 'ai_4': {'model': 'openai/qwen-max', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5, 'description': '擅长使用策略和心理战术'}}, 'prompts': {'decision_making': '你是一个德州扑克玩家。{historical_context}。请根据当前游戏状态和历史信息，按照你的性格特征做出决策。\n\n游戏规则说明:\n1. 可用动作类型:\n   - FOLD (弃牌): 放弃当前手牌，退出本轮游戏\n   - CHECK (过牌): 不加注，保持当前下注额（仅当无人加注时可用）\n   - CALL (跟注): 跟随当前最大注额\n   - RAISE (加注): 将注额提高到指定数量，如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码。\n   - ALL_IN (全下): 押上所有剩余筹码，当筹码不足以加注时，可以选择全下来进行加注。\n\n2. 加注规则:\n   - 加注金额必须大于当前最大注额\n   - 加注金额必须至少是最小加注额\n   - 加注金额不能超过玩家剩余筹码\n   - 如果筹码不足以满足最小加注要求，只能选择 FOLD 或 ALL_IN\n\n3. 行动限制:\n   - 每个玩家每轮只能行动一次\n   - 必须按照顺时针顺序行动\n   - 如果前面有人加注，不能选择过牌\n   - 跟注或加注的金额必须精确匹配要求\n\n当前状态:\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 当前阶段: {phase}\n- 位置: {position}\n- 底池: {pot_size}\n- 当前最大注: {current_bet}\n- 最小加注额: {min_raise} (这是你必须加注到的最小金额)\n- 我的筹码: {chips}\n\n对手信息:\n{opponents}\n\n本轮动作历史:\n{round_actions}\n\n请记住你的性格特征，在做出决策时要体现出相应的风格。\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "action": {{\n    "type": "动作类型(FOLD/CHECK/CALL/RAISE/ALL_IN)",\n    "amount": "加注金额(如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码，如果筹码不足以满足最小加注要求，只能选择弃牌或全下)",\n    "confidence": "决策置信度(0-1)"\n  }},\n  "reasoning": {{\n    "hand_strength": "手牌强度分析",\n    "position_analysis": "位置分析",\n    "pot_odds": "底池赔率分析",\n    "opponent_reads": ["对手行为分析"]\n  }},\n  "table_talk": {{\n    "message": "发言内容",\n    "tone": "发言语气"\n  }}\n}}\n', 'round_summary': '请总结本轮游戏的关键信息:\n\n牌局信息:\n- 阶段: {phase}\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 最终底池: {pot_size}\n- 获得筹码: {chips_won}\n\n玩家动作:\n{player_actions}\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "analysis": {{\n    "strategy_patterns": ["策略模式分析"],\n    "key_decisions": ["关键决策分析"],\n    "improvements": ["改进建议"]\n  }},\n  "metadata": {{\n    "importance": "重要性评分(1-5)",\n    "tags": ["相关标签"]\n  }}\n}} \n'}, 'memory': {'short_term': {'max_rounds': 10}, 'long_term': {'collection': 'poker_memories', 'max_results': 5, 'similarity_threshold': 0.8, 'pruning_days': 30}}}
2025-02-25 12:26:29,161 - src.agents.llm - INFO - LLM Agent ai_1 初始化完成，使用模型 openai/gpt-4o，性格: 擅长使用策略和心理战术
2025-02-25 12:26:29,161 - src.engine.state - INFO - Added player ai_1 with 1000 chips at position 1
2025-02-25 12:26:29,161 - src.engine.game - INFO - Added player ai_1 to game b052bf8d-4edf-45f2-8952-228cd1a82ee5
2025-02-25 12:26:29,162 - server - INFO - 成功创建AI玩家: ai_1, 模型: openai/gpt-4o
2025-02-25 12:26:29,162 - Agent_ai_2 - INFO - Agent ai_2 initialized with config: {'ai_players': {'ai_1': {'model': 'openai/gpt-4o', 'api_key': 'fk230129-9OLw5WmxAHl1cRdmzXuzKIe3HYzEWjz3', 'base_url': 'https://oa.api2d.net/v1', 'temperature': 0.5, 'max_tokens': 10000, 'timeout': 15, 'description': '擅长使用策略和心理战术'}, 'ai_2': {'model': 'openai/deepseek-v3', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 15, 'description': '擅长使用策略和心理战术'}, 'ai_3': {'model': 'openai/claude-3-5-sonnet', 'api_key': 'fk230129-9OLw5WmxAHl1cRdmzXuzKIe3HYzEWjz3', 'base_url': 'https://oa.api2d.net/claude/v1/', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5, 'description': '擅长使用策略和心理战术'}, 'ai_4': {'model': 'openai/qwen-max', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5, 'description': '擅长使用策略和心理战术'}}, 'prompts': {'decision_making': '你是一个德州扑克玩家。{historical_context}。请根据当前游戏状态和历史信息，按照你的性格特征做出决策。\n\n游戏规则说明:\n1. 可用动作类型:\n   - FOLD (弃牌): 放弃当前手牌，退出本轮游戏\n   - CHECK (过牌): 不加注，保持当前下注额（仅当无人加注时可用）\n   - CALL (跟注): 跟随当前最大注额\n   - RAISE (加注): 将注额提高到指定数量，如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码。\n   - ALL_IN (全下): 押上所有剩余筹码，当筹码不足以加注时，可以选择全下来进行加注。\n\n2. 加注规则:\n   - 加注金额必须大于当前最大注额\n   - 加注金额必须至少是最小加注额\n   - 加注金额不能超过玩家剩余筹码\n   - 如果筹码不足以满足最小加注要求，只能选择 FOLD 或 ALL_IN\n\n3. 行动限制:\n   - 每个玩家每轮只能行动一次\n   - 必须按照顺时针顺序行动\n   - 如果前面有人加注，不能选择过牌\n   - 跟注或加注的金额必须精确匹配要求\n\n当前状态:\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 当前阶段: {phase}\n- 位置: {position}\n- 底池: {pot_size}\n- 当前最大注: {current_bet}\n- 最小加注额: {min_raise} (这是你必须加注到的最小金额)\n- 我的筹码: {chips}\n\n对手信息:\n{opponents}\n\n本轮动作历史:\n{round_actions}\n\n请记住你的性格特征，在做出决策时要体现出相应的风格。\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "action": {{\n    "type": "动作类型(FOLD/CHECK/CALL/RAISE/ALL_IN)",\n    "amount": "加注金额(如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码，如果筹码不足以满足最小加注要求，只能选择弃牌或全下)",\n    "confidence": "决策置信度(0-1)"\n  }},\n  "reasoning": {{\n    "hand_strength": "手牌强度分析",\n    "position_analysis": "位置分析",\n    "pot_odds": "底池赔率分析",\n    "opponent_reads": ["对手行为分析"]\n  }},\n  "table_talk": {{\n    "message": "发言内容",\n    "tone": "发言语气"\n  }}\n}}\n', 'round_summary': '请总结本轮游戏的关键信息:\n\n牌局信息:\n- 阶段: {phase}\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 最终底池: {pot_size}\n- 获得筹码: {chips_won}\n\n玩家动作:\n{player_actions}\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "analysis": {{\n    "strategy_patterns": ["策略模式分析"],\n    "key_decisions": ["关键决策分析"],\n    "improvements": ["改进建议"]\n  }},\n  "metadata": {{\n    "importance": "重要性评分(1-5)",\n    "tags": ["相关标签"]\n  }}\n}} \n'}, 'memory': {'short_term': {'max_rounds': 10}, 'long_term': {'collection': 'poker_memories', 'max_results': 5, 'similarity_threshold': 0.8, 'pruning_days': 30}}}
2025-02-25 12:26:29,163 - src.agents.llm - INFO - LLM Agent ai_2 初始化完成，使用模型 openai/deepseek-v3，性格: 擅长使用策略和心理战术
2025-02-25 12:26:29,165 - src.engine.state - INFO - Added player ai_2 with 1000 chips at position 2
2025-02-25 12:26:29,165 - src.engine.game - INFO - Added player ai_2 to game b052bf8d-4edf-45f2-8952-228cd1a82ee5
2025-02-25 12:26:29,166 - server - INFO - 成功创建AI玩家: ai_2, 模型: openai/deepseek-v3
2025-02-25 12:26:29,166 - Agent_ai_3 - INFO - Agent ai_3 initialized with config: {'ai_players': {'ai_1': {'model': 'openai/gpt-4o', 'api_key': 'fk230129-9OLw5WmxAHl1cRdmzXuzKIe3HYzEWjz3', 'base_url': 'https://oa.api2d.net/v1', 'temperature': 0.5, 'max_tokens': 10000, 'timeout': 15, 'description': '擅长使用策略和心理战术'}, 'ai_2': {'model': 'openai/deepseek-v3', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 15, 'description': '擅长使用策略和心理战术'}, 'ai_3': {'model': 'openai/claude-3-5-sonnet', 'api_key': 'fk230129-9OLw5WmxAHl1cRdmzXuzKIe3HYzEWjz3', 'base_url': 'https://oa.api2d.net/claude/v1/', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5, 'description': '擅长使用策略和心理战术'}, 'ai_4': {'model': 'openai/qwen-max', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5, 'description': '擅长使用策略和心理战术'}}, 'prompts': {'decision_making': '你是一个德州扑克玩家。{historical_context}。请根据当前游戏状态和历史信息，按照你的性格特征做出决策。\n\n游戏规则说明:\n1. 可用动作类型:\n   - FOLD (弃牌): 放弃当前手牌，退出本轮游戏\n   - CHECK (过牌): 不加注，保持当前下注额（仅当无人加注时可用）\n   - CALL (跟注): 跟随当前最大注额\n   - RAISE (加注): 将注额提高到指定数量，如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码。\n   - ALL_IN (全下): 押上所有剩余筹码，当筹码不足以加注时，可以选择全下来进行加注。\n\n2. 加注规则:\n   - 加注金额必须大于当前最大注额\n   - 加注金额必须至少是最小加注额\n   - 加注金额不能超过玩家剩余筹码\n   - 如果筹码不足以满足最小加注要求，只能选择 FOLD 或 ALL_IN\n\n3. 行动限制:\n   - 每个玩家每轮只能行动一次\n   - 必须按照顺时针顺序行动\n   - 如果前面有人加注，不能选择过牌\n   - 跟注或加注的金额必须精确匹配要求\n\n当前状态:\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 当前阶段: {phase}\n- 位置: {position}\n- 底池: {pot_size}\n- 当前最大注: {current_bet}\n- 最小加注额: {min_raise} (这是你必须加注到的最小金额)\n- 我的筹码: {chips}\n\n对手信息:\n{opponents}\n\n本轮动作历史:\n{round_actions}\n\n请记住你的性格特征，在做出决策时要体现出相应的风格。\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "action": {{\n    "type": "动作类型(FOLD/CHECK/CALL/RAISE/ALL_IN)",\n    "amount": "加注金额(如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码，如果筹码不足以满足最小加注要求，只能选择弃牌或全下)",\n    "confidence": "决策置信度(0-1)"\n  }},\n  "reasoning": {{\n    "hand_strength": "手牌强度分析",\n    "position_analysis": "位置分析",\n    "pot_odds": "底池赔率分析",\n    "opponent_reads": ["对手行为分析"]\n  }},\n  "table_talk": {{\n    "message": "发言内容",\n    "tone": "发言语气"\n  }}\n}}\n', 'round_summary': '请总结本轮游戏的关键信息:\n\n牌局信息:\n- 阶段: {phase}\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 最终底池: {pot_size}\n- 获得筹码: {chips_won}\n\n玩家动作:\n{player_actions}\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "analysis": {{\n    "strategy_patterns": ["策略模式分析"],\n    "key_decisions": ["关键决策分析"],\n    "improvements": ["改进建议"]\n  }},\n  "metadata": {{\n    "importance": "重要性评分(1-5)",\n    "tags": ["相关标签"]\n  }}\n}} \n'}, 'memory': {'short_term': {'max_rounds': 10}, 'long_term': {'collection': 'poker_memories', 'max_results': 5, 'similarity_threshold': 0.8, 'pruning_days': 30}}}
2025-02-25 12:26:29,168 - src.agents.llm - INFO - LLM Agent ai_3 初始化完成，使用模型 openai/claude-3-5-sonnet，性格: 擅长使用策略和心理战术
2025-02-25 12:26:29,169 - src.engine.state - INFO - Added player ai_3 with 1000 chips at position 3
2025-02-25 12:26:29,169 - src.engine.game - INFO - Added player ai_3 to game b052bf8d-4edf-45f2-8952-228cd1a82ee5
2025-02-25 12:26:29,169 - server - INFO - 成功创建AI玩家: ai_3, 模型: openai/claude-3-5-sonnet
2025-02-25 12:26:29,170 - Agent_ai_4 - INFO - Agent ai_4 initialized with config: {'ai_players': {'ai_1': {'model': 'openai/gpt-4o', 'api_key': 'fk230129-9OLw5WmxAHl1cRdmzXuzKIe3HYzEWjz3', 'base_url': 'https://oa.api2d.net/v1', 'temperature': 0.5, 'max_tokens': 10000, 'timeout': 15, 'description': '擅长使用策略和心理战术'}, 'ai_2': {'model': 'openai/deepseek-v3', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 15, 'description': '擅长使用策略和心理战术'}, 'ai_3': {'model': 'openai/claude-3-5-sonnet', 'api_key': 'fk230129-9OLw5WmxAHl1cRdmzXuzKIe3HYzEWjz3', 'base_url': 'https://oa.api2d.net/claude/v1/', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5, 'description': '擅长使用策略和心理战术'}, 'ai_4': {'model': 'openai/qwen-max', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 15000, 'timeout': 5, 'description': '擅长使用策略和心理战术'}}, 'prompts': {'decision_making': '你是一个德州扑克玩家。{historical_context}。请根据当前游戏状态和历史信息，按照你的性格特征做出决策。\n\n游戏规则说明:\n1. 可用动作类型:\n   - FOLD (弃牌): 放弃当前手牌，退出本轮游戏\n   - CHECK (过牌): 不加注，保持当前下注额（仅当无人加注时可用）\n   - CALL (跟注): 跟随当前最大注额\n   - RAISE (加注): 将注额提高到指定数量，如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码。\n   - ALL_IN (全下): 押上所有剩余筹码，当筹码不足以加注时，可以选择全下来进行加注。\n\n2. 加注规则:\n   - 加注金额必须大于当前最大注额\n   - 加注金额必须至少是最小加注额\n   - 加注金额不能超过玩家剩余筹码\n   - 如果筹码不足以满足最小加注要求，只能选择 FOLD 或 ALL_IN\n\n3. 行动限制:\n   - 每个玩家每轮只能行动一次\n   - 必须按照顺时针顺序行动\n   - 如果前面有人加注，不能选择过牌\n   - 跟注或加注的金额必须精确匹配要求\n\n当前状态:\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 当前阶段: {phase}\n- 位置: {position}\n- 底池: {pot_size}\n- 当前最大注: {current_bet}\n- 最小加注额: {min_raise} (这是你必须加注到的最小金额)\n- 我的筹码: {chips}\n\n对手信息:\n{opponents}\n\n本轮动作历史:\n{round_actions}\n\n请记住你的性格特征，在做出决策时要体现出相应的风格。\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "action": {{\n    "type": "动作类型(FOLD/CHECK/CALL/RAISE/ALL_IN)",\n    "amount": "加注金额(如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码，如果筹码不足以满足最小加注要求，只能选择弃牌或全下)",\n    "confidence": "决策置信度(0-1)"\n  }},\n  "reasoning": {{\n    "hand_strength": "手牌强度分析",\n    "position_analysis": "位置分析",\n    "pot_odds": "底池赔率分析",\n    "opponent_reads": ["对手行为分析"]\n  }},\n  "table_talk": {{\n    "message": "发言内容",\n    "tone": "发言语气"\n  }}\n}}\n', 'round_summary': '请总结本轮游戏的关键信息:\n\n牌局信息:\n- 阶段: {phase}\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 最终底池: {pot_size}\n- 获得筹码: {chips_won}\n\n玩家动作:\n{player_actions}\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "analysis": {{\n    "strategy_patterns": ["策略模式分析"],\n    "key_decisions": ["关键决策分析"],\n    "improvements": ["改进建议"]\n  }},\n  "metadata": {{\n    "importance": "重要性评分(1-5)",\n    "tags": ["相关标签"]\n  }}\n}} \n'}, 'memory': {'short_term': {'max_rounds': 10}, 'long_term': {'collection': 'poker_memories', 'max_results': 5, 'similarity_threshold': 0.8, 'pruning_days': 30}}}
2025-02-25 12:26:29,172 - src.agents.llm - INFO - LLM Agent ai_4 初始化完成，使用模型 openai/qwen-max，性格: 擅长使用策略和心理战术
2025-02-25 12:26:29,173 - src.engine.state - INFO - Added player ai_4 with 1000 chips at position 4
2025-02-25 12:26:29,173 - src.engine.game - INFO - Added player ai_4 to game b052bf8d-4edf-45f2-8952-228cd1a82ee5
2025-02-25 12:26:29,174 - server - INFO - 成功创建AI玩家: ai_4, 模型: openai/qwen-max
2025-02-25 12:26:29,174 - src.engine.game - INFO - 庄家位置移动到: 1
2025-02-25 12:26:29,174 - src.engine.state - INFO - 回合状态已重置
2025-02-25 12:26:29,174 - src.engine.dealer - INFO - Dealt hole cards to 5 players
2025-02-25 12:26:29,174 - src.engine.state - INFO - 玩家 ai_2 下注 10 筹码
2025-02-25 12:26:29,175 - src.engine.game - INFO - 玩家 ai_2 下注小盲注 10
2025-02-25 12:26:29,175 - src.engine.state - INFO - 玩家 ai_3 下注 20 筹码
2025-02-25 12:26:29,175 - src.engine.game - INFO - 玩家 ai_3 下注大盲注 20
2025-02-25 12:26:29,176 - src.engine.game - INFO - 已收取盲注: 小盲注=ai_2(10)，大盲注=ai_3(20)
2025-02-25 12:26:29,176 - src.engine.game - INFO - 当前玩家: ai_4
2025-02-25 12:26:29,177 - src.engine.game - INFO - Game b052bf8d-4edf-45f2-8952-228cd1a82ee5 started
2025-02-25 12:26:29,177 - server - INFO - 游戏 b052bf8d-4edf-45f2-8952-228cd1a82ee5 已开始
2025-02-25 12:26:29,177 - server - INFO - 游戏初始状态: {'phase': 'PRE_FLOP', 'pot_size': 30, 'community_cards': [], 'current_player': 'ai_4', 'min_raise': 40, 'max_raise': 1000, 'game_result': None, 'players': []}
2025-02-25 12:26:29,636 - server - INFO - WebSocket连接已建立: b052bf8d-4edf-45f2-8952-228cd1a82ee5
2025-02-25 12:26:29,637 - server - INFO - 发送初始游戏状态: {'phase': 'PRE_FLOP', 'pot_size': 30, 'community_cards': [], 'current_player': 'ai_4', 'min_raise': 40, 'max_raise': 1000, 'game_result': None, 'players': [{'id': 'player_0', 'chips': 1000, 'current_bet': 0, 'is_active': True, 'cards': ('10♠', '2♥'), 'is_all_in': False, 'position': 0, 'model_name': None, 'last_action': None, 'last_amount': None}, {'id': 'ai_1', 'chips': 1000, 'current_bet': 0, 'is_active': True, 'cards': ('10♥', '7♣'), 'is_all_in': False, 'position': 1, 'model_name': 'openai/gpt-4o', 'last_action': None, 'last_amount': None}, {'id': 'ai_2', 'chips': 990, 'current_bet': 10, 'is_active': True, 'cards': ('A♣', 'K♣'), 'is_all_in': False, 'position': 2, 'model_name': 'openai/deepseek-v3', 'last_action': None, 'last_amount': None}, {'id': 'ai_3', 'chips': 980, 'current_bet': 20, 'is_active': True, 'cards': ('J♥', '4♠'), 'is_all_in': False, 'position': 3, 'model_name': 'openai/claude-3-5-sonnet', 'last_action': None, 'last_amount': None}, {'id': 'ai_4', 'chips': 1000, 'current_bet': 0, 'is_active': True, 'cards': ('5♣', '3♣'), 'is_all_in': False, 'position': 4, 'model_name': 'openai/qwen-max', 'last_action': None, 'last_amount': None}]}
2025-02-25 12:26:29,638 - server - INFO - 当前AI玩家: ai_4
2025-02-25 12:26:29,638 - server - INFO - AI玩家 ai_4 开始观察游戏状态
2025-02-25 12:26:29,639 - src.agents.llm - INFO - AI玩家 ai_4 观察到新的游戏状态
2025-02-25 12:26:29,639 - src.agents.llm - INFO - 
==================================================
2025-02-25 12:26:29,639 - src.agents.llm - INFO - 🤖 AI玩家 {self.agent_id} 思考中...
2025-02-25 12:26:29,639 - src.agents.llm - INFO - 使用模型: openai/qwen-max
2025-02-25 12:26:30,277 - src.agents.llm - ERROR - ❌ LLM调用失败: litellm.BadRequestError: OpenAIException - Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: Range of max_tokens should be [1, 8192]', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-13c21b42-cd3d-9717-b556-c52b521b7aa7', 'request_id': '13c21b42-cd3d-9717-b556-c52b521b7aa7'}
2025-02-25 12:26:30,278 - src.agents.llm - WARNING - 决策生成失败 (尝试 1/3): litellm.BadRequestError: OpenAIException - Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: Range of max_tokens should be [1, 8192]', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-13c21b42-cd3d-9717-b556-c52b521b7aa7', 'request_id': '13c21b42-cd3d-9717-b556-c52b521b7aa7'}
2025-02-25 12:26:31,279 - src.agents.llm - INFO - 
==================================================
2025-02-25 12:26:31,280 - src.agents.llm - INFO - 🤖 AI玩家 {self.agent_id} 思考中...
2025-02-25 12:26:31,282 - src.agents.llm - INFO - 使用模型: openai/qwen-max
2025-02-25 12:26:31,366 - src.agents.llm - ERROR - ❌ LLM调用失败: litellm.BadRequestError: OpenAIException - Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: Range of max_tokens should be [1, 8192]', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-4d5d1c2b-d318-971a-804d-acf28a9bb862', 'request_id': '4d5d1c2b-d318-971a-804d-acf28a9bb862'}
2025-02-25 12:26:31,366 - src.agents.llm - WARNING - 决策生成失败 (尝试 2/3): litellm.BadRequestError: OpenAIException - Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: Range of max_tokens should be [1, 8192]', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-4d5d1c2b-d318-971a-804d-acf28a9bb862', 'request_id': '4d5d1c2b-d318-971a-804d-acf28a9bb862'}
2025-02-25 12:26:32,371 - src.agents.llm - INFO - 
==================================================
2025-02-25 12:26:32,371 - src.agents.llm - INFO - 🤖 AI玩家 {self.agent_id} 思考中...
2025-02-25 12:26:32,371 - src.agents.llm - INFO - 使用模型: openai/qwen-max
2025-02-25 12:26:32,461 - src.agents.llm - ERROR - ❌ LLM调用失败: litellm.BadRequestError: OpenAIException - Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: Range of max_tokens should be [1, 8192]', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-fd2b4412-485f-9187-b110-c0f02e713c03', 'request_id': 'fd2b4412-485f-9187-b110-c0f02e713c03'}
2025-02-25 12:26:32,461 - src.agents.llm - WARNING - 决策生成失败 (尝试 3/3): litellm.BadRequestError: OpenAIException - Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: Range of max_tokens should be [1, 8192]', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-fd2b4412-485f-9187-b110-c0f02e713c03', 'request_id': 'fd2b4412-485f-9187-b110-c0f02e713c03'}
2025-02-25 12:26:33,475 - src.agents.llm - ERROR - 达到最大重试次数，选择弃牌。最后一次错误: litellm.BadRequestError: OpenAIException - Error code: 400 - {'error': {'code': 'invalid_parameter_error', 'param': None, 'message': '<400> InternalError.Algo.InvalidParameter: Range of max_tokens should be [1, 8192]', 'type': 'invalid_request_error'}, 'id': 'chatcmpl-fd2b4412-485f-9187-b110-c0f02e713c03', 'request_id': 'fd2b4412-485f-9187-b110-c0f02e713c03'}
2025-02-25 12:26:33,476 - server - INFO - AI玩家 ai_4 决定执行动作: FOLD, 金额: 0
2025-02-25 12:26:33,478 - src.engine.state - INFO - 玩家 ai_4 弃牌
2025-02-25 12:26:33,479 - src.engine.game - INFO - 玩家 ai_4 弃牌
2025-02-25 12:26:33,481 - src.engine.game - INFO - 当前最大下注额: 20
2025-02-25 12:26:33,481 - src.engine.game - INFO - 当前玩家更新为: player_0
2025-02-25 12:26:33,482 - src.engine.game - INFO - 当前最大下注额: 20
2025-02-25 12:26:33,482 - src.engine.game - INFO - 检查玩家 player_0: has_acted=False, current_bet=0, is_all_in=False
2025-02-25 12:26:33,482 - src.engine.game - INFO - 玩家 player_0 未行动且未全下，回合继续
2025-02-25 12:26:33,482 - server - INFO - 发送AI行动后的游戏状态: {'phase': 'PRE_FLOP', 'pot_size': 30, 'community_cards': [], 'current_player': 'player_0', 'min_raise': 0, 'max_raise': 0, 'game_result': None, 'players': [{'id': 'player_0', 'chips': 1000, 'current_bet': 0, 'is_active': True, 'cards': ('10♠', '2♥'), 'is_all_in': False, 'position': 0, 'model_name': None, 'last_action': None, 'last_amount': None}, {'id': 'ai_1', 'chips': 1000, 'current_bet': 0, 'is_active': True, 'cards': ('10♥', '7♣'), 'is_all_in': False, 'position': 1, 'model_name': 'openai/gpt-4o', 'last_action': None, 'last_amount': None}, {'id': 'ai_2', 'chips': 990, 'current_bet': 10, 'is_active': True, 'cards': ('A♣', 'K♣'), 'is_all_in': False, 'position': 2, 'model_name': 'openai/deepseek-v3', 'last_action': None, 'last_amount': None}, {'id': 'ai_3', 'chips': 980, 'current_bet': 20, 'is_active': True, 'cards': ('J♥', '4♠'), 'is_all_in': False, 'position': 3, 'model_name': 'openai/claude-3-5-sonnet', 'last_action': None, 'last_amount': None}, {'id': 'ai_4', 'chips': 1000, 'current_bet': 0, 'is_active': False, 'cards': [], 'is_all_in': False, 'position': 4, 'model_name': 'openai/qwen-max', 'last_action': 'FOLD', 'last_amount': 0}]}
2025-02-25 12:26:33,483 - src.engine.game - INFO - 当前最大下注额: 20
2025-02-25 12:26:33,483 - src.engine.game - INFO - 检查玩家 player_0: has_acted=False, current_bet=0, is_all_in=False
2025-02-25 12:26:33,483 - src.engine.game - INFO - 玩家 player_0 未行动且未全下，回合继续
2025-02-25 12:40:08,570 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\game.yml
2025-02-25 12:40:08,575 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\llm.yml
2025-02-25 14:27:54,658 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\game.yml
2025-02-25 14:27:54,662 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\llm.yml
2025-02-25 14:28:01,762 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\game.yml
2025-02-25 14:28:01,766 - src.utils.config - INFO - 成功加载配置文件: C:\Users\YiCheng\TexasHoldemAgent\config\llm.yml
2025-02-25 14:28:01,873 - server - INFO - 返回主页: C:\Users\YiCheng\TexasHoldemAgent\src\web\index.html
2025-02-25 14:28:02,309 - server - INFO - 正在创建游戏: eac7a987-c05b-43bf-b958-474b208e5c45, 玩家数量: 5
2025-02-25 14:28:02,309 - src.engine.dealer - INFO - Deck has been reset and shuffled
2025-02-25 14:28:02,309 - src.engine.state - INFO - 游戏状态已初始化
2025-02-25 14:28:02,310 - src.engine.game - INFO - 游戏 eac7a987-c05b-43bf-b958-474b208e5c45 已初始化，玩家数量: 0，初始筹码: 1000，小盲注: 10
2025-02-25 14:28:02,310 - src.engine.state - INFO - Added player player_0 with 1000 chips at position 0
2025-02-25 14:28:02,310 - server - INFO - 添加人类玩家: player_0, 初始筹码: 1000
2025-02-25 14:28:02,311 - Agent_ai_1 - INFO - Agent ai_1 initialized with config: {'ai_players': {'ai_1': {'model': 'openrouter/openai/o3-mini', 'api_key': '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', 'base_url': 'https://openrouter.ai/api/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_2': {'model': 'openai/deepseek-v3', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_3': {'model': 'openrouter/anthropic/claude-3.7-sonnet', 'api_key': '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', 'base_url': 'https://openrouter.ai/api/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_4': {'model': 'openai/qwen-max', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}}, 'prompts': {'decision_making': '你是一个德州扑克玩家。{historical_context}。请根据当前游戏状态和历史信息，按照你的性格特征做出决策。\n\n游戏规则说明:\n1. 可用动作类型:\n   - FOLD (弃牌): 放弃当前手牌，退出本轮游戏\n   - CHECK (过牌): 不加注，保持当前下注额（仅当无人加注时可用）\n   - CALL (跟注): 跟随当前最大注额\n   - RAISE (加注): 将注额提高到指定数量，如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码。\n   - ALL_IN (全下): 押上所有剩余筹码，当筹码不足以加注时，可以选择全下来进行加注。\n\n2. 加注规则:\n   - 加注金额必须大于当前最大注额\n   - 加注金额必须至少是最小加注额\n   - 加注金额不能超过玩家剩余筹码\n   - 如果筹码不足以满足最小加注要求，只能选择 FOLD 或 ALL_IN\n\n3. 行动限制:\n   - 每个玩家每轮只能行动一次\n   - 必须按照顺时针顺序行动\n   - 如果前面有人加注，不能选择过牌\n   - 跟注或加注的金额必须精确匹配要求\n\n当前状态:\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 当前阶段: {phase}\n- 位置: {position}\n- 底池: {pot_size}\n- 当前最大注: {current_bet}\n- 最小加注额: {min_raise} (这是你必须加注到的最小金额)\n- 我的筹码: {chips}\n\n对手信息:\n{opponents}\n\n本轮动作历史:\n{round_actions}\n\n请记住你的性格特征，在做出决策时要体现出相应的风格。\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "action": {{\n    "type": "动作类型(FOLD/CHECK/CALL/RAISE/ALL_IN)",\n    "amount": "加注金额(如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码，如果筹码不足以满足最小加注要求，只能选择弃牌或全下)",\n    "confidence": "决策置信度(0-1)"\n  }},\n  "reasoning": {{\n    "hand_strength": "手牌强度分析",\n    "position_analysis": "位置分析",\n    "pot_odds": "底池赔率分析",\n    "opponent_reads": ["对手行为分析"]\n  }},\n  "table_talk": {{\n    "message": "发言内容",\n    "tone": "发言语气"\n  }}\n}}\n', 'round_summary': '请总结本轮游戏的关键信息:\n\n牌局信息:\n- 阶段: {phase}\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 最终底池: {pot_size}\n- 获得筹码: {chips_won}\n\n玩家动作:\n{player_actions}\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "analysis": {{\n    "strategy_patterns": ["策略模式分析"],\n    "key_decisions": ["关键决策分析"],\n    "improvements": ["改进建议"]\n  }},\n  "metadata": {{\n    "importance": "重要性评分(1-5)",\n    "tags": ["相关标签"]\n  }}\n}} \n'}, 'memory': {'short_term': {'max_rounds': 10}, 'long_term': {'collection': 'poker_memories', 'max_results': 5, 'similarity_threshold': 0.8, 'pruning_days': 30}}}
2025-02-25 14:28:02,312 - src.agents.llm - INFO - LLM Agent ai_1 初始化完成，使用模型 openrouter/openai/o3-mini，性格: 擅长使用策略和心理战术
2025-02-25 14:28:02,313 - src.engine.state - INFO - Added player ai_1 with 1000 chips at position 1
2025-02-25 14:28:02,313 - src.engine.game - INFO - Added player ai_1 to game eac7a987-c05b-43bf-b958-474b208e5c45
2025-02-25 14:28:02,313 - server - INFO - 成功创建AI玩家: ai_1, 模型: openrouter/openai/o3-mini
2025-02-25 14:28:02,314 - Agent_ai_2 - INFO - Agent ai_2 initialized with config: {'ai_players': {'ai_1': {'model': 'openrouter/openai/o3-mini', 'api_key': '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', 'base_url': 'https://openrouter.ai/api/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_2': {'model': 'openai/deepseek-v3', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_3': {'model': 'openrouter/anthropic/claude-3.7-sonnet', 'api_key': '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', 'base_url': 'https://openrouter.ai/api/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_4': {'model': 'openai/qwen-max', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}}, 'prompts': {'decision_making': '你是一个德州扑克玩家。{historical_context}。请根据当前游戏状态和历史信息，按照你的性格特征做出决策。\n\n游戏规则说明:\n1. 可用动作类型:\n   - FOLD (弃牌): 放弃当前手牌，退出本轮游戏\n   - CHECK (过牌): 不加注，保持当前下注额（仅当无人加注时可用）\n   - CALL (跟注): 跟随当前最大注额\n   - RAISE (加注): 将注额提高到指定数量，如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码。\n   - ALL_IN (全下): 押上所有剩余筹码，当筹码不足以加注时，可以选择全下来进行加注。\n\n2. 加注规则:\n   - 加注金额必须大于当前最大注额\n   - 加注金额必须至少是最小加注额\n   - 加注金额不能超过玩家剩余筹码\n   - 如果筹码不足以满足最小加注要求，只能选择 FOLD 或 ALL_IN\n\n3. 行动限制:\n   - 每个玩家每轮只能行动一次\n   - 必须按照顺时针顺序行动\n   - 如果前面有人加注，不能选择过牌\n   - 跟注或加注的金额必须精确匹配要求\n\n当前状态:\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 当前阶段: {phase}\n- 位置: {position}\n- 底池: {pot_size}\n- 当前最大注: {current_bet}\n- 最小加注额: {min_raise} (这是你必须加注到的最小金额)\n- 我的筹码: {chips}\n\n对手信息:\n{opponents}\n\n本轮动作历史:\n{round_actions}\n\n请记住你的性格特征，在做出决策时要体现出相应的风格。\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "action": {{\n    "type": "动作类型(FOLD/CHECK/CALL/RAISE/ALL_IN)",\n    "amount": "加注金额(如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码，如果筹码不足以满足最小加注要求，只能选择弃牌或全下)",\n    "confidence": "决策置信度(0-1)"\n  }},\n  "reasoning": {{\n    "hand_strength": "手牌强度分析",\n    "position_analysis": "位置分析",\n    "pot_odds": "底池赔率分析",\n    "opponent_reads": ["对手行为分析"]\n  }},\n  "table_talk": {{\n    "message": "发言内容",\n    "tone": "发言语气"\n  }}\n}}\n', 'round_summary': '请总结本轮游戏的关键信息:\n\n牌局信息:\n- 阶段: {phase}\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 最终底池: {pot_size}\n- 获得筹码: {chips_won}\n\n玩家动作:\n{player_actions}\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "analysis": {{\n    "strategy_patterns": ["策略模式分析"],\n    "key_decisions": ["关键决策分析"],\n    "improvements": ["改进建议"]\n  }},\n  "metadata": {{\n    "importance": "重要性评分(1-5)",\n    "tags": ["相关标签"]\n  }}\n}} \n'}, 'memory': {'short_term': {'max_rounds': 10}, 'long_term': {'collection': 'poker_memories', 'max_results': 5, 'similarity_threshold': 0.8, 'pruning_days': 30}}}
2025-02-25 14:28:02,315 - src.agents.llm - INFO - LLM Agent ai_2 初始化完成，使用模型 openai/deepseek-v3，性格: 擅长使用策略和心理战术
2025-02-25 14:28:02,315 - src.engine.state - INFO - Added player ai_2 with 1000 chips at position 2
2025-02-25 14:28:02,315 - src.engine.game - INFO - Added player ai_2 to game eac7a987-c05b-43bf-b958-474b208e5c45
2025-02-25 14:28:02,316 - server - INFO - 成功创建AI玩家: ai_2, 模型: openai/deepseek-v3
2025-02-25 14:28:02,316 - Agent_ai_3 - INFO - Agent ai_3 initialized with config: {'ai_players': {'ai_1': {'model': 'openrouter/openai/o3-mini', 'api_key': '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', 'base_url': 'https://openrouter.ai/api/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_2': {'model': 'openai/deepseek-v3', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_3': {'model': 'openrouter/anthropic/claude-3.7-sonnet', 'api_key': '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', 'base_url': 'https://openrouter.ai/api/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_4': {'model': 'openai/qwen-max', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}}, 'prompts': {'decision_making': '你是一个德州扑克玩家。{historical_context}。请根据当前游戏状态和历史信息，按照你的性格特征做出决策。\n\n游戏规则说明:\n1. 可用动作类型:\n   - FOLD (弃牌): 放弃当前手牌，退出本轮游戏\n   - CHECK (过牌): 不加注，保持当前下注额（仅当无人加注时可用）\n   - CALL (跟注): 跟随当前最大注额\n   - RAISE (加注): 将注额提高到指定数量，如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码。\n   - ALL_IN (全下): 押上所有剩余筹码，当筹码不足以加注时，可以选择全下来进行加注。\n\n2. 加注规则:\n   - 加注金额必须大于当前最大注额\n   - 加注金额必须至少是最小加注额\n   - 加注金额不能超过玩家剩余筹码\n   - 如果筹码不足以满足最小加注要求，只能选择 FOLD 或 ALL_IN\n\n3. 行动限制:\n   - 每个玩家每轮只能行动一次\n   - 必须按照顺时针顺序行动\n   - 如果前面有人加注，不能选择过牌\n   - 跟注或加注的金额必须精确匹配要求\n\n当前状态:\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 当前阶段: {phase}\n- 位置: {position}\n- 底池: {pot_size}\n- 当前最大注: {current_bet}\n- 最小加注额: {min_raise} (这是你必须加注到的最小金额)\n- 我的筹码: {chips}\n\n对手信息:\n{opponents}\n\n本轮动作历史:\n{round_actions}\n\n请记住你的性格特征，在做出决策时要体现出相应的风格。\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "action": {{\n    "type": "动作类型(FOLD/CHECK/CALL/RAISE/ALL_IN)",\n    "amount": "加注金额(如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码，如果筹码不足以满足最小加注要求，只能选择弃牌或全下)",\n    "confidence": "决策置信度(0-1)"\n  }},\n  "reasoning": {{\n    "hand_strength": "手牌强度分析",\n    "position_analysis": "位置分析",\n    "pot_odds": "底池赔率分析",\n    "opponent_reads": ["对手行为分析"]\n  }},\n  "table_talk": {{\n    "message": "发言内容",\n    "tone": "发言语气"\n  }}\n}}\n', 'round_summary': '请总结本轮游戏的关键信息:\n\n牌局信息:\n- 阶段: {phase}\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 最终底池: {pot_size}\n- 获得筹码: {chips_won}\n\n玩家动作:\n{player_actions}\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "analysis": {{\n    "strategy_patterns": ["策略模式分析"],\n    "key_decisions": ["关键决策分析"],\n    "improvements": ["改进建议"]\n  }},\n  "metadata": {{\n    "importance": "重要性评分(1-5)",\n    "tags": ["相关标签"]\n  }}\n}} \n'}, 'memory': {'short_term': {'max_rounds': 10}, 'long_term': {'collection': 'poker_memories', 'max_results': 5, 'similarity_threshold': 0.8, 'pruning_days': 30}}}
2025-02-25 14:28:02,318 - src.agents.llm - INFO - LLM Agent ai_3 初始化完成，使用模型 openrouter/anthropic/claude-3.7-sonnet，性格: 擅长使用策略和心理战术
2025-02-25 14:28:02,318 - src.engine.state - INFO - Added player ai_3 with 1000 chips at position 3
2025-02-25 14:28:02,318 - src.engine.game - INFO - Added player ai_3 to game eac7a987-c05b-43bf-b958-474b208e5c45
2025-02-25 14:28:02,318 - server - INFO - 成功创建AI玩家: ai_3, 模型: openrouter/anthropic/claude-3.7-sonnet
2025-02-25 14:28:02,319 - Agent_ai_4 - INFO - Agent ai_4 initialized with config: {'ai_players': {'ai_1': {'model': 'openrouter/openai/o3-mini', 'api_key': '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', 'base_url': 'https://openrouter.ai/api/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_2': {'model': 'openai/deepseek-v3', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_3': {'model': 'openrouter/anthropic/claude-3.7-sonnet', 'api_key': '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', 'base_url': 'https://openrouter.ai/api/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}, 'ai_4': {'model': 'openai/qwen-max', 'api_key': 'sk-c35f8f8afc75416daeaa412d96543299', 'base_url': 'https://dashscope.aliyuncs.com/compatible-mode/v1', 'temperature': 0.5, 'max_tokens': 8000, 'timeout': 30, 'description': '擅长使用策略和心理战术'}}, 'prompts': {'decision_making': '你是一个德州扑克玩家。{historical_context}。请根据当前游戏状态和历史信息，按照你的性格特征做出决策。\n\n游戏规则说明:\n1. 可用动作类型:\n   - FOLD (弃牌): 放弃当前手牌，退出本轮游戏\n   - CHECK (过牌): 不加注，保持当前下注额（仅当无人加注时可用）\n   - CALL (跟注): 跟随当前最大注额\n   - RAISE (加注): 将注额提高到指定数量，如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码。\n   - ALL_IN (全下): 押上所有剩余筹码，当筹码不足以加注时，可以选择全下来进行加注。\n\n2. 加注规则:\n   - 加注金额必须大于当前最大注额\n   - 加注金额必须至少是最小加注额\n   - 加注金额不能超过玩家剩余筹码\n   - 如果筹码不足以满足最小加注要求，只能选择 FOLD 或 ALL_IN\n\n3. 行动限制:\n   - 每个玩家每轮只能行动一次\n   - 必须按照顺时针顺序行动\n   - 如果前面有人加注，不能选择过牌\n   - 跟注或加注的金额必须精确匹配要求\n\n当前状态:\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 当前阶段: {phase}\n- 位置: {position}\n- 底池: {pot_size}\n- 当前最大注: {current_bet}\n- 最小加注额: {min_raise} (这是你必须加注到的最小金额)\n- 我的筹码: {chips}\n\n对手信息:\n{opponents}\n\n本轮动作历史:\n{round_actions}\n\n请记住你的性格特征，在做出决策时要体现出相应的风格。\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "action": {{\n    "type": "动作类型(FOLD/CHECK/CALL/RAISE/ALL_IN)",\n    "amount": "加注金额(如果选择加注，必须至少是当前最大注的两倍，加注金额不能超过玩家剩余筹码，如果筹码不足以满足最小加注要求，只能选择弃牌或全下)",\n    "confidence": "决策置信度(0-1)"\n  }},\n  "reasoning": {{\n    "hand_strength": "手牌强度分析",\n    "position_analysis": "位置分析",\n    "pot_odds": "底池赔率分析",\n    "opponent_reads": ["对手行为分析"]\n  }},\n  "table_talk": {{\n    "message": "发言内容",\n    "tone": "发言语气"\n  }}\n}}\n', 'round_summary': '请总结本轮游戏的关键信息:\n\n牌局信息:\n- 阶段: {phase}\n- 手牌: {hand_cards}\n- 公共牌: {community_cards}\n- 最终底池: {pot_size}\n- 获得筹码: {chips_won}\n\n玩家动作:\n{player_actions}\n\n警告：这是一个严格的格式要求！\n1. 你必须只返回一个原始的JSON对象\n2. 禁止使用任何markdown标记（如```json）\n3. 禁止在JSON前后添加任何其他字符\n4. 禁止添加任何额外的换行或缩进\n5. 违反以上任何一条都将导致解析错误\n\n直接返回以下格式的JSON:\n{{\n  "analysis": {{\n    "strategy_patterns": ["策略模式分析"],\n    "key_decisions": ["关键决策分析"],\n    "improvements": ["改进建议"]\n  }},\n  "metadata": {{\n    "importance": "重要性评分(1-5)",\n    "tags": ["相关标签"]\n  }}\n}} \n'}, 'memory': {'short_term': {'max_rounds': 10}, 'long_term': {'collection': 'poker_memories', 'max_results': 5, 'similarity_threshold': 0.8, 'pruning_days': 30}}}
2025-02-25 14:28:02,320 - src.agents.llm - INFO - LLM Agent ai_4 初始化完成，使用模型 openai/qwen-max，性格: 擅长使用策略和心理战术
2025-02-25 14:28:02,320 - src.engine.state - INFO - Added player ai_4 with 1000 chips at position 4
2025-02-25 14:28:02,321 - src.engine.game - INFO - Added player ai_4 to game eac7a987-c05b-43bf-b958-474b208e5c45
2025-02-25 14:28:02,321 - server - INFO - 成功创建AI玩家: ai_4, 模型: openai/qwen-max
2025-02-25 14:28:02,321 - src.engine.game - INFO - 庄家位置移动到: 1
2025-02-25 14:28:02,321 - src.engine.state - INFO - 回合状态已重置
2025-02-25 14:28:02,321 - src.engine.dealer - INFO - Dealt hole cards to 5 players
2025-02-25 14:28:02,322 - src.engine.state - INFO - 玩家 ai_2 下注 10 筹码
2025-02-25 14:28:02,322 - src.engine.game - INFO - 玩家 ai_2 下注小盲注 10
2025-02-25 14:28:02,322 - src.engine.state - INFO - 玩家 ai_3 下注 20 筹码
2025-02-25 14:28:02,322 - src.engine.game - INFO - 玩家 ai_3 下注大盲注 20
2025-02-25 14:28:02,322 - src.engine.game - INFO - 已收取盲注: 小盲注=ai_2(10)，大盲注=ai_3(20)
2025-02-25 14:28:02,323 - src.engine.game - INFO - 当前玩家: ai_4
2025-02-25 14:28:02,323 - src.engine.game - INFO - Game eac7a987-c05b-43bf-b958-474b208e5c45 started
2025-02-25 14:28:02,323 - server - INFO - 游戏 eac7a987-c05b-43bf-b958-474b208e5c45 已开始
2025-02-25 14:28:02,323 - server - INFO - 游戏初始状态: {'phase': 'PRE_FLOP', 'pot_size': 30, 'community_cards': [], 'current_player': 'ai_4', 'min_raise': 40, 'max_raise': 1000, 'game_result': None, 'players': []}
2025-02-25 14:28:03,081 - server - INFO - WebSocket连接已建立: eac7a987-c05b-43bf-b958-474b208e5c45
2025-02-25 14:28:03,081 - server - INFO - 发送初始游戏状态: {'phase': 'PRE_FLOP', 'pot_size': 30, 'community_cards': [], 'current_player': 'ai_4', 'min_raise': 40, 'max_raise': 1000, 'game_result': None, 'players': [{'id': 'player_0', 'chips': 1000, 'current_bet': 0, 'is_active': True, 'cards': ('8♥', '2♠'), 'is_all_in': False, 'position': 0, 'model_name': None, 'last_action': None, 'last_amount': None}, {'id': 'ai_1', 'chips': 1000, 'current_bet': 0, 'is_active': True, 'cards': ('3♠', '4♦'), 'is_all_in': False, 'position': 1, 'model_name': 'openrouter/openai/o3-mini', 'last_action': None, 'last_amount': None}, {'id': 'ai_2', 'chips': 990, 'current_bet': 10, 'is_active': True, 'cards': ('5♣', 'J♣'), 'is_all_in': False, 'position': 2, 'model_name': 'openai/deepseek-v3', 'last_action': None, 'last_amount': None}, {'id': 'ai_3', 'chips': 980, 'current_bet': 20, 'is_active': True, 'cards': ('Q♠', '10♣'), 'is_all_in': False, 'position': 3, 'model_name': 'openrouter/anthropic/claude-3.7-sonnet', 'last_action': None, 'last_amount': None}, {'id': 'ai_4', 'chips': 1000, 'current_bet': 0, 'is_active': True, 'cards': ('J♥', '6♥'), 'is_all_in': False, 'position': 4, 'model_name': 'openai/qwen-max', 'last_action': None, 'last_amount': None}]}
2025-02-25 14:28:03,083 - server - INFO - 当前AI玩家: ai_4
2025-02-25 14:28:03,083 - server - INFO - AI玩家 ai_4 开始观察游戏状态
2025-02-25 14:28:03,083 - src.agents.llm - INFO - AI玩家 ai_4 观察到新的游戏状态
2025-02-25 14:28:03,083 - src.agents.llm - INFO - 
==================================================
2025-02-25 14:28:03,084 - src.agents.llm - INFO - 🤖 AI玩家 {self.agent_id} 思考中...
2025-02-25 14:28:03,084 - src.agents.llm - INFO - 使用模型: openai/qwen-max
2025-02-25 14:28:15,068 - src.agents.llm - INFO - 
💭 决策结果:
{"action":{"type":"RAISE","amount":60,"confidence":0.75},"reasoning":{"hand_strength":"手牌为J♥, 6♥，虽然不是很强，但有同花的可能性。在前期可以尝试通过加注来控制底池大小并测试对手的反应。","position_analysis":"位于中间位置，有一定的信息优势，可以根据后续玩家的动作灵活调整策略。","pot_odds":"当前底池为30，以60加注后底池将变为90，考虑到我的筹码量足够支持这种试探性加注。","opponent_reads":["所有对手都处于激活状态且尚未做出重大决策，这表明他们可能也在评估自己的手牌强度。"]},"table_talk":{"message":"让我们看看谁更有胆量。","tone":"挑衅"}}
2025-02-25 14:28:15,069 - src.agents.llm - INFO - ==================================================

2025-02-25 14:28:15,069 - src.agents.llm - INFO - 生成动作: RAISE 金额: 60 table_talk: {'message': '让我们看看谁更有胆量。', 'tone': '挑衅'}
2025-02-25 14:28:15,069 - server - INFO - AI玩家 ai_4 决定执行动作: RAISE, 金额: 60
2025-02-25 14:28:15,070 - src.engine.game - INFO - 处理玩家 ai_4 的行动: ActionType.RAISE
2025-02-25 14:28:15,070 - src.engine.state - INFO - 玩家 ai_4 加注到 60 筹码，已标记为已行动
2025-02-25 14:28:15,070 - src.engine.game - INFO - 玩家 ai_4 加注到 60
2025-02-25 14:28:15,070 - src.engine.state - INFO - 添加动作到历史记录: RAISE by ai_4
2025-02-25 14:28:15,071 - src.engine.game - INFO - 已记录玩家 ai_4 的行动
2025-02-25 14:28:15,071 - src.engine.game - INFO - 更新当前玩家，原始玩家: ai_4
2025-02-25 14:28:15,071 - src.engine.game - INFO - 当前最大下注额: 60
2025-02-25 14:28:15,071 - src.engine.game - INFO - 找到下一个玩家(从头开始): player_0, 位置: 0
2025-02-25 14:28:15,071 - src.engine.game - INFO - 当前玩家从 ai_4 更新为 player_0
2025-02-25 14:28:15,072 - src.engine.game - INFO - 更新当前玩家为: player_0
2025-02-25 14:28:15,072 - src.engine.game - INFO - 检查回合是否完成
2025-02-25 14:28:15,072 - src.engine.game - INFO - 活跃玩家数量: 5, 玩家ID: ['player_0', 'ai_1', 'ai_2', 'ai_3', 'ai_4']
2025-02-25 14:28:15,072 - src.engine.game - INFO - 当前最大下注额: 60
2025-02-25 14:28:15,072 - src.engine.game - INFO - 检查玩家 player_0: has_acted=False, current_bet=0, is_all_in=False
2025-02-25 14:28:15,072 - src.engine.game - INFO - 玩家 player_0 未行动，回合继续
2025-02-25 14:28:15,073 - src.engine.game - INFO - 回合完成判断: 所有玩家已行动=False, 所有下注相等=True, 回合完成=False
2025-02-25 14:28:15,073 - src.engine.game - INFO - 回合是否完成: False
2025-02-25 14:28:15,073 - server - INFO - 发送AI行动后的游戏状态: {'phase': 'PRE_FLOP', 'pot_size': 90, 'community_cards': [], 'current_player': 'player_0', 'min_raise': 0, 'max_raise': 0, 'game_result': None, 'players': [{'id': 'player_0', 'chips': 1000, 'current_bet': 0, 'is_active': True, 'cards': ('8♥', '2♠'), 'is_all_in': False, 'position': 0, 'model_name': None, 'last_action': None, 'last_amount': None}, {'id': 'ai_1', 'chips': 1000, 'current_bet': 0, 'is_active': True, 'cards': ('3♠', '4♦'), 'is_all_in': False, 'position': 1, 'model_name': 'openrouter/openai/o3-mini', 'last_action': None, 'last_amount': None}, {'id': 'ai_2', 'chips': 990, 'current_bet': 10, 'is_active': True, 'cards': ('5♣', 'J♣'), 'is_all_in': False, 'position': 2, 'model_name': 'openai/deepseek-v3', 'last_action': None, 'last_amount': None}, {'id': 'ai_3', 'chips': 980, 'current_bet': 20, 'is_active': True, 'cards': ('Q♠', '10♣'), 'is_all_in': False, 'position': 3, 'model_name': 'openrouter/anthropic/claude-3.7-sonnet', 'last_action': None, 'last_amount': None}, {'id': 'ai_4', 'chips': 940, 'current_bet': 60, 'is_active': True, 'cards': ('J♥', '6♥'), 'is_all_in': False, 'position': 4, 'model_name': 'openai/qwen-max', 'last_action': 'RAISE', 'last_amount': 60}], 'table_talk': {'message': '让我们看看谁更有胆量。', 'tone': '挑衅'}}
2025-02-25 14:28:15,074 - src.engine.game - INFO - 检查回合是否完成
2025-02-25 14:28:15,074 - src.engine.game - INFO - 活跃玩家数量: 5, 玩家ID: ['player_0', 'ai_1', 'ai_2', 'ai_3', 'ai_4']
2025-02-25 14:28:15,074 - src.engine.game - INFO - 当前最大下注额: 60
2025-02-25 14:28:15,074 - src.engine.game - INFO - 检查玩家 player_0: has_acted=False, current_bet=0, is_all_in=False
2025-02-25 14:28:15,075 - src.engine.game - INFO - 玩家 player_0 未行动，回合继续
2025-02-25 14:28:15,075 - src.engine.game - INFO - 回合完成判断: 所有玩家已行动=False, 所有下注相等=True, 回合完成=False
